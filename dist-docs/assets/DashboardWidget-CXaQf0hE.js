import{l as w,e as p,y as E,U as G,c as u,g as f,o,a as n,d as O,i as y,t as k,D as z,h as b,n as h,F as B,b as L,v as J,x as Q,E as Z,m as ee,M as te}from"./index-GxWqBnN7.js";import ae from"./Loader-BXlGcE_d.js";import se from"./BarChart-CcLjMIfJ.js";import ne from"./LineChart-D3QVjct_.js";import _ from"./PieChart-CJddDAA6.js";const ie={key:0,class:"flex bg-(--ui-surface) items-center justify-between px-6 py-4 border-b ui-border-strong shrink-0"},re={class:"flex items-center gap-3"},oe={class:"font-semibold text-lg ui-text"},le={class:"flex items-center gap-2"},ue=["disabled"],de={key:1,class:"absolute top-16 right-4 z-20 ui-surface rounded-lg shadow-xl border ui-border-strong p-4 min-w-[250px]"},ce={class:"flex items-center justify-between mb-3"},fe={class:"space-y-3"},he=["for"],ge=["id","onClick"],ve={key:2,class:"absolute top-16 right-4 z-20 ui-surface rounded-lg shadow-xl border ui-border-strong p-4 min-w-[280px]"},me={class:"flex items-center justify-between mb-3"},pe={class:"space-y-2"},ye={class:"ui-text"},be={class:"px-2 py-1 ui-surface-muted border ui-border-strong rounded text-xs font-mono"},we={class:"relative flex-1 overflow-hidden"},xe={key:0,class:"absolute inset-0 bg-[color:color-mix(in oklab, var(--ui-surface), transparent 10%)] backdrop-blur-sm z-10 flex items-center justify-center"},ke={class:"w-full h-full flex items-center justify-center"},Ce={key:3,class:"border-t ui-border-strong px-6 py-3 ui-surface-muted shrink-0"},He={__name:"DashboardWidget",props:{id:{type:String,required:!0},title:{type:String,required:!0},icon:{type:String,default:null},requiredRoles:{type:Function,default:null},loading:{type:Boolean,default:!1},height:{type:String,default:"auto"},maxHeight:{type:String,default:"none"},minHeight:{type:String,default:"200px"},width:{type:String,default:"100%"},showRefresh:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},padding:{type:String,default:"normal"},hasRole:{type:Function,default:()=>()=>!1},chartType:{type:String,default:null},chartData:{type:Object,default:null},chartOptions:{type:Object,default:()=>({})},customizationOptions:{type:Array,default:()=>[]}},emits:["refresh","dragstart","dragend","customize","keypress"],setup(r,{emit:A}){const t=r,g=A,F=w(()=>t.requiredRoles?t.requiredRoles(t.hasRole):!0),N=w(()=>({width:t.width,height:t.height!=="auto"?t.height:void 0,maxHeight:t.maxHeight!=="none"?t.maxHeight:void 0,minHeight:t.minHeight})),S={none:"",small:"p-3",normal:"p-4",large:"p-6"},v=p(!1),i=p({});E(()=>{t.customizationOptions.forEach(e=>{i.value[e.id]=e.default??!0})});const C=()=>{v.value=!v.value},P=(e,a)=>{i.value[e]=a,g("customize",{...i.value})},q=p(null),x=p(!1),R=e=>{if(!x.value)return;const a={r:()=>g("refresh"),R:()=>g("refresh"),c:()=>C(),C:()=>C(),Escape:()=>v.value=!1,h:()=>d.value=!d.value,H:()=>d.value=!d.value,"?":()=>d.value=!d.value};a[e.key]&&(e.preventDefault(),a[e.key](),g("keypress",e.key))},V=()=>{x.value=!0},K=()=>{x.value=!1},d=p(!1),W=[{key:"R",description:"Refresh widget"},{key:"C",description:"Open customization"},{key:"Esc",description:"Close panels"},{key:"?",description:"Toggle help"}],D=p(!1);let l=null;const X=e=>{if(!e.dataTransfer)return;D.value=!0,g("dragstart",t.id);const a=e.target.getBoundingClientRect();l=e.target.cloneNode(!0),Object.assign(l.style,{position:"fixed",width:`${a.width}px`,height:`${a.height}px`,pointerEvents:"none",opacity:"0.8",zIndex:"1000",left:`${e.clientX-a.width/2}px`,top:`${e.clientY-a.height/2}px`}),document.body.appendChild(l),e.dataTransfer.setDragImage(l,a.width/2,a.height/2),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id)},H=e=>{l&&e.clientX&&e.clientY&&(l.style.left=`${e.clientX-l.offsetWidth/2}px`,l.style.top=`${e.clientY-l.offsetHeight/2}px`)},Y=()=>{D.value=!1,g("dragend",t.id),l&&(document.body.removeChild(l),l=null)},T=w(()=>{if(!t.chartType||!t.chartData)return null;const e=t.chartData.datasets?.[0]?.data||t.chartData.data||[],a=t.chartData.labels||[],s=e.filter(m=>m!=null&&!isNaN(m));if(s.length===0)return null;const $=t.chartType==="pie"||t.chartType==="doughnut",M=$?450:400,U=$?450:400,c={data:s,labels:a.slice(0,s.length),width:M,height:U,...t.chartOptions};if(i.value.legend!==void 0&&(c.showLegend=i.value.legend),i.value.grid!==void 0&&(c.showGrid=i.value.grid),i.value.values!==void 0&&(c.showValues=i.value.values),i.value.percentages!==void 0&&(c.showPercentages=i.value.percentages),i.value.points!==void 0&&(c.showPoints=i.value.points),i.value.fillArea!==void 0&&(c.fillArea=i.value.fillArea),t.chartData.datasets?.[0]?.backgroundColor){const m=t.chartData.datasets[0].backgroundColor;c.colors=Array.isArray(m)?m:[m]}return t.chartData.datasets?.[0]?.borderColor&&(c.lineColor=t.chartData.datasets[0].borderColor),c}),j=w(()=>{switch(t.chartType){case"bar":return se;case"line":return ne;case"pie":return _;case"doughnut":return _;default:return null}}),I=w(()=>t.chartType==="doughnut");return E(()=>{window.addEventListener("dragover",H),window.addEventListener("keydown",R)}),G(()=>{window.removeEventListener("dragover",H),window.removeEventListener("keydown",R),l&&document.body.removeChild(l)}),(e,a)=>F.value?(o(),u("div",{key:0,ref_key:"widgetRef",ref:q,draggable:"true",tabindex:"0",style:Z(N.value),class:h(ee(te)(" rounded-xl border ui-border-strong overflow-hidden transition-all select-none flex flex-col relative","shadow-sm",D.value?"opacity-50 scale-95":"hover:shadow-lg cursor-move",x.value?"ring-2 ring-(--ui-primary) ring-offset-2":"")),onDragstart:X,onDragend:Y,onFocus:V,onBlur:K},[r.showHeader?(o(),u("div",ie,[n("div",re,[r.icon?(o(),O(y,{key:0,icon:r.icon,class:"w-5 h-5 ui-text"},null,8,["icon"])):f("",!0),n("h3",oe,k(r.title),1)]),n("div",le,[z(e.$slots,"header-actions"),n("button",{class:"p-2 rounded-lg hover:bg-[color:color-mix(in oklab, var(--ui-surface), transparent 20%)] transition-all duration-200 hover:scale-105 active:scale-95",title:"Keyboard shortcuts (?)",onClick:a[0]||(a[0]=s=>d.value=!d.value)},[b(y,{icon:"circle-info",class:"w-4 h-4 ui-text"})]),r.customizationOptions.length>0?(o(),u("button",{key:0,class:h(["p-2 rounded-lg hover:bg-[color:color-mix(in oklab, var(--ui-surface), transparent 20%)] transition-all duration-200 hover:scale-105 active:scale-95",{"ui-primary-soft":v.value}]),title:"Customize (C)",onClick:C},[b(y,{icon:"gear",class:"w-4 h-4 ui-text"})],2)):f("",!0),r.showRefresh?(o(),u("button",{key:1,class:"p-2 rounded-lg hover:bg-[color:color-mix(in oklab, var(--ui-surface), transparent 20%)] transition-all duration-200 hover:scale-105 active:scale-95",disabled:r.loading,title:"Refresh (R)",onClick:a[1]||(a[1]=s=>e.$emit("refresh"))},[b(y,{icon:"refresh",class:h(["w-4 h-4 ui-text transition-transform duration-500",{"animate-spin":r.loading}])},null,8,["class"])],8,ue)):f("",!0)])])):f("",!0),v.value?(o(),u("div",de,[n("div",ce,[a[4]||(a[4]=n("h4",{class:"font-semibold text-sm ui-text"}," Customize Widget ",-1)),n("button",{class:"p-1 rounded hover:bg-(--ui-surface)",onClick:a[2]||(a[2]=s=>v.value=!1)},[b(y,{icon:"x",class:"w-4 h-4 ui-text"})])]),n("div",fe,[(o(!0),u(B,null,L(r.customizationOptions,s=>(o(),u("div",{key:s.id,class:"flex items-center justify-between"},[n("label",{for:`setting-${s.id}`,class:"text-sm ui-text cursor-pointer"},k(s.label),9,he),n("button",{id:`setting-${s.id}`,class:h(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",i.value[s.id]?"ui-primary":"ui-surface"]),onClick:$=>P(s.id,!i.value[s.id])},[n("span",{class:h(["inline-block h-4 w-4 transform rounded-full ui-surface transition-transform",i.value[s.id]?"translate-x-6":"translate-x-1"])},null,2)],10,ge)]))),128))])])):f("",!0),d.value?(o(),u("div",ve,[n("div",me,[a[5]||(a[5]=n("h4",{class:"font-semibold text-sm ui-text"}," Keyboard Shortcuts ",-1)),n("button",{class:"p-1 rounded hover:bg-(--ui-surface)",onClick:a[3]||(a[3]=s=>d.value=!1)},[b(y,{icon:"x",class:"w-4 h-4 ui-text"})])]),n("div",pe,[(o(),u(B,null,L(W,s=>n("div",{key:s.key,class:"flex items-center justify-between text-sm"},[n("span",ye,k(s.description),1),n("kbd",be,k(s.key),1)])),64))])])):f("",!0),n("div",we,[r.loading?(o(),u("div",xe,[b(ae,{type:"spin",size:"medium",color:"#3b82f6"})])):f("",!0),r.chartType&&r.chartData&&j.value&&T.value?(o(),u("div",{key:1,class:h(["w-full h-full flex items-center justify-center p-4",S[r.padding]])},[n("div",ke,[(o(),O(Q(j.value),J(T.value,{doughnut:I.value}),null,16,["doughnut"]))])],2)):(o(),u("div",{key:2,class:h(["overflow-auto h-full",S[r.padding]])},[z(e.$slots,"default")],2))]),e.$slots.footer?(o(),u("div",Ce,[z(e.$slots,"footer")])):f("",!0)],38)):f("",!0)}};export{He as default};
