import{k as Y,f as q,g as E,d as b,o as m,w as F,a as h,t as $,K as ne,c as v,F as H,b as K,n as g,q as R,m as G,h as x,e as S}from"./index-swU1CFca.js";import re from"./Modal-4zDQVSp5.js";import se from"./Slider-BwxNkg_b.js";import oe from"./DatePicker-DB_xo-H5.js";import le from"./FormField-Ftm5D_dA.js";import k from"./Input-CC-MODul.js";import ue from"./Textarea-DHz6EfEb.js";import me from"./MultiSelect-Dd0i5rTc.js";import J from"./Button-c5O5D_l4.js";import{t as M}from"./toast-BjMW1k9Q.js";import L from"./Label-BlvPZULz.js";import Q from"./FileUpload-Dj9HMHhp.js";import"./Badge-BJJ0MFkX.js";import"./CircularProgress-Ch0H0niu.js";const ie={class:"mb-6"},ce={class:"text-xl font-semibold ui-text"},pe={class:"text-sm ui-text mt-1"},de={class:"grid grid-cols-12 gap-6"},ye=["value"],be={key:5,class:"flex items-center"},ve={key:6,class:"flex items-center"},he=["id","aria-checked","disabled","onClick"],ge={key:7,class:"space-y-2"},xe={key:8,class:"w-full"},Ve={key:0,class:"mt-2 text-xs ui-text"},$e={key:9,class:"w-full"},we={key:0,class:"mt-2 text-xs ui-text"},ke={key:11,class:"space-y-2"},Fe={class:"flex items-center gap-4"},Ce={class:"text-sm font-medium ui-text min-w-12 text-right"},_e={class:"flex justify-end gap-3 pt-6"},De={__name:"ReusableFormModal",props:{modelValue:{type:Boolean,default:!1},modalType:{type:String,required:!0,validator:c=>["create","edit"].includes(c)},entityName:{type:String,default:"Item"},fields:{type:Array,required:!0,validator:c=>c.every(C=>C.name&&C.label&&C.type&&["text","number","password","textarea","select","checkbox","slider","date","color","email","tel","url","time","datetime-local","month","week","file","multifile","radio","switch","range","search","hidden","multiselect","combobox"].includes(C.type))},initialData:{type:Object,default:null},loading:{type:Boolean,default:!1},customValidation:{type:Function,default:null},modalSize:{type:String,default:"4xl",validator:c=>["sm","md","lg","xl","2xl","3xl","4xl","5xl","6xl","7xl","8xl","full"].includes(c)},modalHeight:{type:String,default:"auto"},modalResizable:{type:Boolean,default:!1}},emits:["update:modelValue","submit","close"],setup(c,{emit:C}){const i=c,A=C,O=Y({get:()=>i.modelValue,set:e=>A("update:modelValue",e)}),d=Y(()=>i.loading),l=q({}),u=q({}),w=q(!1),P=q({}),W=q({}),_=(e,t)=>{if(!(!e||!t))return t.split(".").reduce((a,r)=>a?.[r],e)},V=(e,t,a)=>{const r=t.split("."),n=r.pop(),o=r.reduce((s,U)=>(s[U]||(s[U]={}),s[U]),e);o[n]=a},z=()=>{const e={};return i.fields.forEach(t=>{if(t.name.includes(".")){const[a]=t.name.split(".");e[a]||(e[a]={}),V(e,t.name,N(t))}else t.type==="checkbox"||t.type==="switch"?e[t.name]=!1:t.type==="number"||t.type==="slider"||t.type==="range"?e[t.name]=t.min!==void 0?t.min:0:t.type==="file"?e[t.name]=null:t.type==="multifile"?e[t.name]=[]:t.type==="radio"?e[t.name]=t.options?.[0]?.value||"":t.type==="multiselect"?e[t.name]=[]:(t.type,e[t.name]="")}),e},N=e=>e.type==="checkbox"||e.type==="switch"?!1:e.type==="number"||e.type==="slider"||e.type==="range"?e.min!==void 0?e.min:0:e.type==="file"?null:e.type==="multifile"?[]:e.type==="radio"?e.options?.[0]?.value||"":e.type==="multiselect"?[]:(e.type==="combobox",""),T=e=>{const t={};return i.fields.forEach(a=>{if(a.name.includes(".")){const r=_(e,a.name);t[a.name.split(".")[0]]||(t[a.name.split(".")[0]]={}),V(t,a.name,r!==void 0?r:N(a))}else{const r=e?.[a.name];a.type==="checkbox"||a.type==="switch"?t[a.name]=r??!1:a.type==="number"||a.type==="slider"||a.type==="range"?t[a.name]=r??(a.min!==void 0?a.min:0):a.type==="file"?t[a.name]=null:a.type==="multifile"?t[a.name]=Array.isArray(r)?r:[]:a.type==="multiselect"?t[a.name]=Array.isArray(r)?r:[]:t[a.name]=r??N(a)}}),t};E(()=>i.initialData,e=>{i.modalType==="edit"&&e||i.modalType==="create"&&e&&!w.value?(l.value=T(e),w.value=!0):i.modalType==="create"&&!e&&(l.value=z(),w.value=!1)},{immediate:!0,deep:!0}),E(()=>i.modelValue,e=>{e&&(u.value={},i.modalType==="create"&&(w.value=!1,i.initialData?l.value=T(i.initialData):l.value=z(),w.value=!0))}),E(()=>i.initialData,e=>{w.value&&e&&(l.value=T(e))},{deep:!0});const X=()=>{if(u.value={},i.fields.forEach(e=>{if(e.required&&!e.disabled&&e.type!=="hidden"){const t=e.name.includes(".")?_(l.value,e.name):l.value[e.name];e.type==="checkbox"||e.type==="switch"?e.required&&!t&&(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="number"||e.type==="slider"||e.type==="range"?t===""||t===null||t===void 0?u.value[e.name]=e.errorMessage||`${e.label} is required`:e.min!==void 0&&Number(t)<e.min?u.value[e.name]=`${e.label} must be at least ${e.min}`:e.max!==void 0&&Number(t)>e.max&&(u.value[e.name]=`${e.label} must be at most ${e.max}`):e.type==="email"?!t||!t.trim()?u.value[e.name]=e.errorMessage||`${e.label} is required`:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(u.value[e.name]="Please enter a valid email address"):e.type==="url"?!t||!t.trim()?u.value[e.name]=e.errorMessage||`${e.label} is required`:/^https?:\/\/.+/.test(t)||(u.value[e.name]="Please enter a valid URL"):e.type==="tel"?(!t||!t.trim())&&(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="file"?t||(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="multifile"?!Array.isArray(t)||t.length===0?u.value[e.name]=e.errorMessage||`${e.label} is required`:e.minFiles&&t.length<e.minFiles?u.value[e.name]=`Please upload at least ${e.minFiles} file(s)`:e.maxFiles&&t.length>e.maxFiles&&(u.value[e.name]=`Maximum ${e.maxFiles} file(s) allowed`):e.type==="radio"?t||(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="multiselect"?(!Array.isArray(t)||t.length===0)&&(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="combobox"?(!t||typeof t=="string"&&!t.trim())&&(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="date"||e.type==="time"||e.type==="datetime-local"||e.type==="month"||e.type==="week"?(!t||typeof t=="string"&&!t.trim())&&(u.value[e.name]=e.errorMessage||`${e.label} is required`):e.type==="password"?(!t||typeof t=="string"&&!t.trim())&&(u.value[e.name]=e.errorMessage||`${e.label} is required`):(!t||typeof t=="string"&&!t.trim())&&(u.value[e.name]=e.errorMessage||`${e.label} is required`)}if(e.validate&&typeof e.validate=="function"){const t=e.name.includes(".")?_(l.value,e.name):l.value[e.name],a=e.validate(t,l.value);a&&(u.value[e.name]=a)}}),i.customValidation){const e=i.customValidation(l.value);e&&Object.keys(e).length>0&&(u.value={...u.value,...e})}return Object.keys(u.value).length===0},j=async(e,t)=>{if(e.name.includes(".")?V(l.value,e.name,t):l.value[e.name]=t,e.onChange&&typeof e.onChange=="function")try{await e.onChange(t,l.value)}catch(a){console.error("Error in onChange handler:",a),M.error("An error occurred while processing the change")}},Z=(e,t)=>{if(e.name.includes(".")?V(l.value,e.name,t):l.value[e.name]=t,e.onChange&&typeof e.onChange=="function")try{e.onChange(t,l.value)}catch(a){console.error("Error in onChange handler:",a),M.error("An error occurred while processing the change")}},B=async()=>{try{if(i.fields.some(n=>n.type!=="multifile"&&P.value[n.name]?.length>0)){M.error("Please wait for all files to finish uploading");return}if(!X()){M.error("Please fix the validation errors before submitting");return}const t={};let a=!1;i.fields.forEach(n=>{const o=n.name.includes(".")?_(l.value,n.name):l.value[n.name];if(n.type==="number"||n.type==="slider"||n.type==="range")n.name.includes(".")?V(t,n.name,Number(o)):t[n.name]=Number(o);else if(n.type==="file")o instanceof File?(a=!0,t[n.name]=o):i.modalType==="edit"&&o&&(t[n.name]=o);else if(n.type==="multifile")Array.isArray(o)&&o.some(s=>s instanceof File)?(a=!0,t[n.name]=o):i.modalType==="edit"&&Array.isArray(o)&&o.length>0&&(t[n.name]=o);else if(n.type==="text"||n.type==="textarea"||n.type==="date"||n.type==="email"||n.type==="url"||n.type==="tel"||n.type==="search"||n.type==="time"||n.type==="datetime-local"||n.type==="month"||n.type==="week"){const s=typeof o=="string"?o.trim():o;n.name.includes(".")?V(t,n.name,s):t[n.name]=s}else n.type,n.name.includes(".")?V(t,n.name,o):t[n.name]=o});let r=t;a&&(r=I(t),i.modalType==="edit"&&r.append("_method","PUT")),A("submit",{formData:r,modalType:i.modalType,originalData:i.initialData,hasFiles:a})}catch(e){console.error("Error during form submission:",e),M.error("An error occurred during submission")}},I=e=>{const t=new FormData;return Object.keys(e).forEach(a=>{const r=e[a];r!=null&&(r instanceof File?t.append(a,r):Array.isArray(r)?r.forEach((n,o)=>{n instanceof File?t.append(`${a}[]`,n):t.append(`${a}[${o}]`,n)}):typeof r=="object"&&!(r instanceof Date)?Object.keys(r).forEach(n=>{t.append(`${a}[${n}]`,r[n])}):t.append(a,r))}),t},D=()=>{l.value=z(),u.value={},w.value=!1,P.value={},W.value={},A("close")},p=e=>e.includes(".")?_(l.value,e):l.value[e],y=(e,t)=>{e.includes(".")?V(l.value,e,t):l.value[e]=t},f=(e,t)=>{if(y(e.name,t),e.onChange&&typeof e.onChange=="function")try{e.onChange(t,l.value)}catch(a){console.error("Error in onChange handler:",a)}},ee=(e,t)=>{if(y(e.name,t),e.onChange&&typeof e.onChange=="function")try{e.onChange(t,l.value)}catch(a){console.error("Error in onChange handler:",a)}},ae=(e,t)=>{if(y(e.name,t),e.onChange&&typeof e.onChange=="function")try{e.onChange(t,l.value)}catch(a){console.error("Error in onChange handler:",a)}},te=(e,t)=>{if(y(e.name,t),e.onChange&&typeof e.onChange=="function")try{e.onChange(t,l.value)}catch(a){console.error("Error in onChange handler:",a)}};return(e,t)=>(m(),b(re,{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=a=>O.value=a),"show-close":!0,"close-on-backdrop":!0,size:c.modalSize,class:g(c.modalHeight==="auto"?"":c.modalHeight),resizable:c.modalResizable,onClose:D},{default:F(()=>[h("div",ie,[h("h2",ce,$(c.modalType==="create"?`Add New ${c.entityName}`:`Edit ${c.entityName}`),1),h("p",pe,$(c.modalType==="create"?`Fill in the details to create a new ${c.entityName.toLowerCase()}.`:`Update the ${c.entityName.toLowerCase()} information below.`),1)]),h("form",{class:"overflow-y-auto",onSubmit:ne(B,["prevent"])},[h("div",de,[(m(!0),v(H,null,K(c.fields,a=>(m(),v("div",{key:a.name,class:g(a.wrapperClass||"col-span-12")},[a.type==="hidden"?(m(),v("input",{key:0,value:p(a.name),type:"hidden"},null,8,ye)):(m(),b(le,{key:1,id:`form-${c.entityName}-${a.name}-${Math.random().toString(36).slice(2,5)}`,label:a.label,required:a.required&&!a.disabled,error:u.value[a.name],"error-message":u.value[a.name]},{default:F(({fieldId:r,hasError:n,ariaDescribedBy:o})=>[["text","number","password","color","email","tel","url","search"].includes(a.type)?(m(),b(k,{key:0,id:r,"model-value":p(a.name),type:a.type,placeholder:a.placeholder,disabled:d.value||a.disabled,readonly:a.disabled,class:g(n?"border-(--ui-danger)":"ui-border-strong"),"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","type","placeholder","disabled","readonly","class","aria-describedby","onUpdate:modelValue"])):a.type==="textarea"?(m(),b(ue,{key:1,id:r,"model-value":p(a.name),placeholder:a.placeholder,disabled:d.value||a.disabled,rows:a.rows||3,class:g(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-(--ui-primary) ui-surface   border",n?"border-(--ui-danger)":"ui-border-strong"]),"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","placeholder","disabled","rows","class","aria-describedby","onUpdate:modelValue"])):a.type==="select"?(m(),b(G,{key:2,id:r,"model-value":p(a.name),options:a.options,placeholder:a.placeholder||"Select an option",disabled:d.value||a.disabled,"has-error":n,"aria-describedby":o,"onUpdate:modelValue":s=>j(a,s)},null,8,["id","model-value","options","placeholder","disabled","has-error","aria-describedby","onUpdate:modelValue"])):a.type==="multiselect"?(m(),b(me,{key:3,id:r,"model-value":p(a.name),options:a.options,disabled:d.value||a.disabled,placeholder:a.placeholder||"Select options","has-error":n,"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","options","disabled","placeholder","has-error","aria-describedby","onUpdate:modelValue"])):a.type==="combobox"?(m(),b(G,{key:4,id:r,"model-value":p(a.name),options:a.options,placeholder:a.placeholder||"Select or type to add new",disabled:d.value||a.disabled,"has-error":n,"aria-describedby":o,"allow-create":a.allowCreate,"onUpdate:modelValue":s=>j(a,s)},null,8,["id","model-value","options","placeholder","disabled","has-error","aria-describedby","allow-create","onUpdate:modelValue"])):a.type==="checkbox"?(m(),v("div",be,[x(k,{id:r,"model-value":p(a.name),type:"checkbox",disabled:d.value||a.disabled,class:"h-4 w-4 ui-primary focus:ring-(--ui-primary) ui-border-strong rounded","aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","disabled","aria-describedby","onUpdate:modelValue"]),x(L,{for:r,class:"ml-2 text-sm ui-text"},{default:F(()=>[S($(a.checkboxLabel||a.label),1)]),_:2},1032,["for"])])):a.type==="switch"?(m(),v("div",ve,[h("button",{id:r,type:"button",role:"switch","aria-checked":p(a.name),disabled:d.value||a.disabled,class:g(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-(--ui-primary) focus:ring-offset-2",p(a.name)?"ui-primary-bg":"ui-bg",d.value||a.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"]),onClick:s=>y(a.name,!p(a.name))},[h("span",{class:g(["inline-block h-4 w-4 transform rounded-full ui-surface transition-transform",p(a.name)?"translate-x-6":"translate-x-1"])},null,2)],10,he),x(L,{for:r,class:"ml-3 text-sm ui-text"},{default:F(()=>[S($(a.checkboxLabel||a.label),1)]),_:2},1032,["for"])])):a.type==="radio"?(m(),v("div",ge,[(m(!0),v(H,null,K(a.options,s=>(m(),v("div",{key:s.value,class:"flex items-center"},[x(k,{id:`${r}-${s.value}`,"model-value":p(a.name),type:"radio",value:s.value,disabled:d.value||a.disabled,class:"h-4 w-4 ui-primary focus:ring-(--ui-primary) ui-border-strong","aria-describedby":o,"onUpdate:modelValue":U=>y(a.name,U)},null,8,["id","model-value","value","disabled","aria-describedby","onUpdate:modelValue"]),x(L,{for:`${r}-${s.value}`,class:"ml-2 text-sm ui-text"},{default:F(()=>[S($(s.label),1)]),_:2},1032,["for"])]))),128))])):a.type==="file"?(m(),v("div",xe,[x(Q,{multiple:!1,accept:a.accept,"max-size":a.maxSize,variant:a.variant||"default",onFilesSelected:s=>f(a,s),onFileRemoved:s=>ee(a,s)},null,8,["accept","max-size","variant","onFilesSelected","onFileRemoved"]),a.helpText?(m(),v("p",Ve,$(a.helpText),1)):R("",!0)])):a.type==="multifile"?(m(),v("div",$e,[x(Q,{multiple:a.multiple!==!1,accept:a.accept,"max-size":a.maxSize,"max-files":a.maxFiles,variant:a.variant||"default",onFilesSelected:s=>ae(a,s),onFileRemoved:s=>te(a,s)},null,8,["multiple","accept","max-size","max-files","variant","onFilesSelected","onFileRemoved"]),a.helpText?(m(),v("p",we,$(a.helpText),1)):R("",!0)])):a.type==="slider"?(m(),b(se,{key:10,"model-value":p(a.name),min:a.min,max:a.max,step:a.step,disabled:d.value||a.disabled,"onUpdate:modelValue":s=>Z(a,s)},null,8,["model-value","min","max","step","disabled","onUpdate:modelValue"])):a.type==="range"?(m(),v("div",ke,[h("div",Fe,[x(k,{id:r,"model-value":p(a.name),type:"range",min:a.min,max:a.max,step:a.step||1,disabled:d.value||a.disabled,class:"flex-1","aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","min","max","step","disabled","aria-describedby","onUpdate:modelValue"]),h("span",Ce,$(p(a.name)),1)])])):a.type==="date"?(m(),b(oe,{key:12,id:r,"model-value":p(a.name),disabled:d.value||a.disabled,required:a.required,min:a.min,max:a.max,placeholder:a.placeholder||"Select date",format:a.format||"MM/DD/YYYY",clearable:a.clearable!==!1,"show-today":a.showToday!==!1,"calendar-position":a.calendarPosition||"left-0 bottom-full","aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","disabled","required","min","max","placeholder","format","clearable","show-today","calendar-position","aria-describedby","onUpdate:modelValue"])):a.type==="time"?(m(),b(k,{key:13,id:r,"model-value":p(a.name),type:"time",disabled:d.value||a.disabled,class:g(n?"border-(--ui-danger)":"ui-border-strong"),"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","disabled","class","aria-describedby","onUpdate:modelValue"])):a.type==="datetime-local"?(m(),b(k,{key:14,id:r,"model-value":p(a.name),type:"datetime-local",disabled:d.value||a.disabled,class:g(n?"border-(--ui-danger)":"ui-border-strong"),"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","disabled","class","aria-describedby","onUpdate:modelValue"])):a.type==="month"?(m(),b(k,{key:15,id:r,"model-value":p(a.name),type:"month",disabled:d.value||a.disabled,class:g(n?"border-(--ui-danger)":"ui-border-strong"),"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","disabled","class","aria-describedby","onUpdate:modelValue"])):a.type==="week"?(m(),b(k,{key:16,id:r,"model-value":p(a.name),type:"week",disabled:d.value||a.disabled,class:g(n?"border-(--ui-danger)":"ui-border-strong"),"aria-describedby":o,"onUpdate:modelValue":s=>y(a.name,s)},null,8,["id","model-value","disabled","class","aria-describedby","onUpdate:modelValue"])):R("",!0)]),_:2},1032,["id","label","required","error","error-message"]))],2))),128))]),h("div",_e,[x(J,{type:"button",variant:"outline",disabled:d.value,onClick:D},{default:F(()=>[...t[1]||(t[1]=[S(" Cancel ",-1)])]),_:1},8,["disabled"]),x(J,{type:"submit",disabled:d.value,loading:d.value,variant:"info"},{default:F(()=>[S($(c.modalType==="create"?`Create ${c.entityName}`:`Update ${c.entityName}`),1)]),_:1},8,["disabled","loading"])])],32)]),_:1},8,["modelValue","size","class","resizable"]))}};export{De as default};
